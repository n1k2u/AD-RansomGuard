# 1. Detect Meterpreter Sessions (reverse shell initiation)
index=wineventlog EventCode=4688 
| where New_Process_Name="*meterpreter*" OR CommandLine="*msfvenom*" 
| table _time, Hostname, User, New_Process_Name, CommandLine

# 2. Detect PowerShell Execution (especially with suspicious flags)
index=wineventlog EventCode=4688 
| where New_Process_Name="*powershell.exe*" AND CommandLine="*ExecutionPolicy Bypass*" 
| table _time, Hostname, User, CommandLine

# 3. Detect Lateral Movement via SMB
index=wineventlog EventCode=4624 
| where Logon_Type=3 AND Account_Name="Administrator" AND Workstation_Name!="DC" 
| table _time, Workstation_Name, Account_Name, Source_Network_Address

# 4. Detect File Renaming (Simulated Encryption)
index=wineventlog EventCode=4663 
| where Object_Name="*Desktop*" AND Object_Name="*.enc" 
| table _time, Hostname, Object_Name, Access_Mask

# 5. Detect Privilege Escalation Attempts (UAC Bypass)
index=wineventlog EventCode=4673 OR EventCode=4688 
| where Service_Name="fodhelper.exe" 
| table _time, Hostname, User, CommandLine

# 6. Mimikatz/kiwi usage detection (if logging enabled)
index=wineventlog EventCode=4688 
| where CommandLine="*mimikatz*" OR CommandLine="*kiwi*" 
| table _time, Hostname, CommandLine
